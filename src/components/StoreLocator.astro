<section id="store_locator" class="bg-crema">
    <div class="flex flex-col lg:flex-row h-[600px]">
        <!-- Map Container -->
        <div id="map" class="w-full lg:w-[70%] h-full"></div>

        <!-- Location Sidebar -->
        <div class="w-full lg:w-[30%] bg-crema overflow-y-auto">
            <div class="p-8">
                <h2 class="font-futura text-hot-sauce text-[64px] leading-[0.9] uppercase tracking-tight mb-8">Find Us</h2>

                <!-- Location Cards -->
                <div class="flex flex-col gap-6">
                    <!-- Tarrytown -->
                    <div class="location-card cursor-pointer border-b border-ink/10 pb-6" data-location="tarrytown">
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="font-futura text-hot-sauce text-2xl uppercase tracking-tight">Tarrytown, NY</h3>
                            <a href="/tarrytown-ny/" class="text-hot-sauce hover:opacity-80 transition-opacity">
                                <span class="font-geist text-[12px] uppercase">About Store →</span>
                            </a>
                        </div>
                        <p class="font-geist text-ink text-[14px] leading-[1.4] mb-1">18 Main St. / (914) 909-4455</p>
                        <div class="flex gap-3 mt-4">
                            <a href="https://order.toasttab.com/online/the-taco-project-tarrytown-18-main-street" target="_blank" rel="noopener noreferrer" class="btn btn-primary text-xs">Order Online</a>
                            <a href="https://www.toasttab.com/catering/the-taco-project-tarrytown-18-main-street" target="_blank" rel="noopener noreferrer" class="btn btn-secondary text-xs">Order Catering</a>
                        </div>
                    </div>

                    <!-- Yonkers -->
                    <div class="location-card cursor-pointer border-b border-ink/10 pb-6" data-location="yonkers">
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="font-futura text-hot-sauce text-2xl uppercase tracking-tight">Yonkers, NY</h3>
                            <a href="/yonkers-ny/" class="text-hot-sauce hover:opacity-80 transition-opacity">
                                <span class="font-geist text-[12px] uppercase">About Store →</span>
                            </a>
                        </div>
                        <p class="font-geist text-ink text-[14px] leading-[1.4] mb-1">1086 N Broadway. / (914) 375-4000</p>
                        <div class="flex gap-3 mt-4">
                            <a href="https://order.toasttab.com/online/the-taco-project-yonkers-1086-north-broadway" target="_blank" rel="noopener noreferrer" class="btn btn-primary text-xs">Order Online</a>
                            <a href="https://www.toasttab.com/catering/the-taco-project-yonkers-1086-north-broadway" target="_blank" rel="noopener noreferrer" class="btn btn-secondary text-xs">Order Catering</a>
                        </div>
                    </div>

                    <!-- Pleasantville -->
                    <div class="location-card cursor-pointer border-b border-ink/10 pb-6" data-location="pleasantville">
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="font-futura text-hot-sauce text-2xl uppercase tracking-tight">Pleasantville, NY</h3>
                            <a href="/pleasantville-ny/" class="text-hot-sauce hover:opacity-80 transition-opacity">
                                <span class="font-geist text-[12px] uppercase">About Store →</span>
                            </a>
                        </div>
                        <p class="font-geist text-ink text-[14px] leading-[1.4] mb-1">465 Bedford Rd. / (914) 422-8111</p>
                        <div class="flex gap-3 mt-4">
                            <a href="https://order.toasttab.com/online/the-taco-project-pleasantville-smb-pos-465-bedford-road" target="_blank" rel="noopener noreferrer" class="btn btn-primary text-xs">Order Online</a>
                            <a href="https://www.toasttab.com/catering/the-taco-project-pleasantville-smb-pos-465-bedford-road" target="_blank" rel="noopener noreferrer" class="btn btn-secondary text-xs">Order Catering</a>
                        </div>
                    </div>

                    <!-- Bronxville -->
                    <div class="location-card cursor-pointer border-b border-ink/10 pb-6" data-location="bronxville">
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="font-futura text-hot-sauce text-2xl uppercase tracking-tight">Bronxville, NY</h3>
                            <a href="/bronxville-ny/" class="text-hot-sauce hover:opacity-80 transition-opacity">
                                <span class="font-geist text-[12px] uppercase">About Store →</span>
                            </a>
                        </div>
                        <p class="font-geist text-ink text-[14px] leading-[1.4] mb-1">65 Pondfield Rd. / (914) 356-8226</p>
                        <div class="flex gap-3 mt-4">
                            <a href="https://order.toasttab.com/online/the-taco-project-bronxville-65-pondfield-rd" target="_blank" rel="noopener noreferrer" class="btn btn-primary text-xs">Order Online</a>
                            <a href="https://www.toasttab.com/catering/the-taco-project-bronxville-65-pondfield-rd" target="_blank" rel="noopener noreferrer" class="btn btn-secondary text-xs">Order Catering</a>
                        </div>
                    </div>

                    <!-- New Rochelle -->
                    <div class="location-card cursor-pointer border-b border-ink/10 pb-6" data-location="new_rochelle">
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="font-futura text-hot-sauce text-2xl uppercase tracking-tight">New Rochelle, NY</h3>
                            <a href="/new-rochelle-ny/" class="text-hot-sauce hover:opacity-80 transition-opacity">
                                <span class="font-geist text-[12px] uppercase">About Store →</span>
                            </a>
                        </div>
                        <p class="font-geist text-ink text-[14px] leading-[1.4] mb-1">596 North Ave. / (914) 729-7949</p>
                        <div class="flex gap-3 mt-4">
                            <a href="https://order.toasttab.com/online/taco-project-new-rochelle-596-north-ave" target="_blank" rel="noopener noreferrer" class="btn btn-primary text-xs">Order Online</a>
                            <a href="https://www.toasttab.com/catering/taco-project-new-rochelle-596-north-ave" target="_blank" rel="noopener noreferrer" class="btn btn-secondary text-xs">Order Catering</a>
                        </div>
                    </div>

                    <!-- Stamford -->
                    <div class="location-card cursor-pointer border-b border-ink/10 pb-6" data-location="stamford">
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="font-futura text-hot-sauce text-2xl uppercase tracking-tight">Stamford, CT</h3>
                            <a href="/stamford-ct/" class="text-hot-sauce hover:opacity-80 transition-opacity">
                                <span class="font-geist text-[12px] uppercase">About Store →</span>
                            </a>
                        </div>
                        <p class="font-geist text-ink text-[14px] leading-[1.4] mb-1">1111 High Ridge Rd. / (203) 703-9495</p>
                        <div class="flex gap-3 mt-4">
                            <a href="https://order.toasttab.com/online/the-taco-project-stamford-1101-high-ridge-road" target="_blank" rel="noopener noreferrer" class="btn btn-primary text-xs">Order Online</a>
                            <a href="https://www.toasttab.com/catering/the-taco-project-stamford-1101-high-ridge-road/" target="_blank" rel="noopener noreferrer" class="btn btn-secondary text-xs">Order Catering</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // Location data
    const locations = {
        tarrytown: { lat: 41.0763606, lng: -73.8591884, name: "Tarrytown, NY", address: "18 Main St." },
        yonkers: { lat: 40.9720459, lng: -73.8820079, name: "Yonkers, NY", address: "1086 N Broadway" },
        pleasantville: { lat: 41.1334438, lng: -73.7926226, name: "Pleasantville, NY", address: "465 Bedford Rd." },
        bronxville: { lat: 40.9408163, lng: -73.8332937, name: "Bronxville, NY", address: "65 Pondfield Rd." },
        new_rochelle: { lat: 40.9223308, lng: -73.7883121, name: "New Rochelle, NY", address: "596 North Ave." },
        stamford: { lat: 41.1084596, lng: -73.5467485, name: "Stamford, CT", address: "1111 High Ridge Rd." },
    };

    let map;
    let markers = {};
    let selectedMarker = null;

    // Initialize map when Google Maps API is loaded
    function initMap() {
        // Center map on all locations
        const bounds = new google.maps.LatLngBounds();

        // Create map
        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 10,
            center: { lat: 41.0, lng: -73.7 },
            styles: [
                {
                    featureType: "all",
                    elementType: "geometry",
                    stylers: [{ color: "#E3E1D4" }],
                },
                {
                    featureType: "water",
                    elementType: "geometry",
                    stylers: [{ color: "#C0BEB3" }],
                },
                {
                    featureType: "road",
                    elementType: "geometry",
                    stylers: [{ color: "#ACABA1" }],
                },
            ],
        });

        // Create custom marker icon (uses /public/pin.svg)
        const markerIcon = {
            url: "/pin.svg",
            scaledSize: new google.maps.Size(40, 56),
            anchor: new google.maps.Point(20, 56),
        };

        const markerIconSelected = {
            url: "/pin.svg",
            scaledSize: new google.maps.Size(50, 70),
            anchor: new google.maps.Point(25, 70),
        };

        // Add markers for each location
        Object.keys(locations).forEach((key) => {
            const location = locations[key];
            const position = { lat: location.lat, lng: location.lng };

            const marker = new google.maps.Marker({
                position: position,
                map: map,
                title: location.name,
                icon: markerIcon,
                animation: google.maps.Animation.DROP,
            });

            // Store marker reference
            markers[key] = { marker, icon: markerIcon, iconSelected: markerIconSelected };

            // Add info window
            const infoWindow = new google.maps.InfoWindow({
                content: `<div style="font-family: 'Geist Mono', monospace; padding: 8px;">
                    <h3 style="font-family: 'Futura Now Headline', sans-serif; color: #D33B0D; margin: 0 0 8px 0; font-size: 18px;">${location.name}</h3>
                    <p style="margin: 0; font-size: 14px; color: #202020;">${location.address}</p>
                </div>`,
            });

            // Click marker to show info
            marker.addListener("click", () => {
                infoWindow.open(map, marker);
            });

            bounds.extend(position);
        });

        // Fit map to show all markers
        map.fitBounds(bounds);

        // Add click handlers to location cards
        document.querySelectorAll(".location-card").forEach((card) => {
            card.addEventListener("click", (e) => {
                // Don't trigger if clicking on a link
                if (e.target.tagName === "A" || e.target.closest("a")) return;

                const locationKey = card.dataset.location;
                selectLocation(locationKey);
            });
        });
    }

    function selectLocation(locationKey) {
        const location = locations[locationKey];
        const markerData = markers[locationKey];

        // Reset previously selected marker
        if (selectedMarker && selectedMarker !== locationKey) {
            const prevMarkerData = markers[selectedMarker];
            prevMarkerData.marker.setIcon(prevMarkerData.icon);
        }

        // Highlight new marker
        markerData.marker.setIcon(markerData.iconSelected);
        selectedMarker = locationKey;

        // Pan and zoom to location
        map.panTo({ lat: location.lat, lng: location.lng });
        map.setZoom(14);

        // Bounce animation
        markerData.marker.setAnimation(google.maps.Animation.BOUNCE);
        setTimeout(() => {
            markerData.marker.setAnimation(null);
        }, 1400);
    }

    // Wait for Google Maps API to load
    if (typeof google !== "undefined" && google.maps) {
        initMap();
    } else {
        window.addEventListener("load", () => {
            if (typeof google !== "undefined" && google.maps) {
                initMap();
            }
        });
    }
</script>
