---
import BaseLayout from "../layouts/BaseLayout.astro";
import StoreLocator from "../components/StoreLocator.astro";
import InstagramFeed from "../components/InstagramFeed.astro";
---

<BaseLayout title="Contact Us | The Taco Project">
    <section class="bg-sky py-16 relative">
        <div class="container">
            <div class="flex flex-col gap-5 items-start text-ink mb-[52px]">
                <h1 class="font-futura text-6xl md:text-[104px] leading-none tracking-tight uppercase text-ink">Contact Us</h1>
                <p class="font-geist font-normal text-sm leading-5 mt-2">For PR/Marketing inquiries please contact <a href="mailto:Marketing@thetacoproject.com" class="underline decoration-solid">Marketing@thetacoproject.com</a>.</p>
            </div>



            <form id="contact-form" name="contact" method="POST" action="/contact/?success=true" data-netlify="true" netlify-honeypot="bot-field" class="mx-auto flex flex-col gap-[30px]">
                <input type="hidden" name="form-name" value="contact" />
                <p class="hidden">
                    <label>Don't fill this out if you're human: <input name="bot-field" /></label>
                </p>

                <!-- First Name, Last Name -->
                <div class="flex flex-col md:flex-row gap-6 w-full">
                    <div class="flex-1 flex flex-col gap-3.5">
                        <label for="contact_first_name" class="font-geist font-normal text-sm leading-5 text-ink">First Name*</label>
                        <input type="text" id="contact_first_name" name="contact_first_name" required class="bg-crema rounded-lg px-6 py-4 font-geist text-sm leading-5 text-ink border-none outline-none focus:ring-2 focus:ring-ocean transition placeholder:text-ink/50" />
                    </div>
                    <div class="flex-1 flex flex-col gap-3.5">
                        <label for="contact_last_name" class="font-geist font-normal text-sm leading-5 text-ink">Last Name*</label>
                        <input type="text" id="contact_last_name" name="contact_last_name" required class="bg-crema rounded-lg px-6 py-4 font-geist text-sm leading-5 text-ink border-none outline-none focus:ring-2 focus:ring-ocean transition placeholder:text-ink/50" />
                    </div>
                </div>

                <!-- Company or Organization, Email -->
                <div class="flex flex-col md:flex-row gap-6 w-full">
                    <div class="flex-1 flex flex-col gap-3.5">
                        <label for="contact_company" class="font-geist font-normal text-sm leading-5 text-ink">Company or Organization</label>
                        <input type="text" id="contact_company" name="contact_company" class="bg-crema rounded-lg px-6 py-4 font-geist text-sm leading-5 text-ink border-none outline-none focus:ring-2 focus:ring-ocean transition placeholder:text-ink/50" />
                    </div>
                    <div class="flex-1 flex flex-col gap-3.5">
                        <label for="contact_email" class="font-geist font-normal text-sm leading-5 text-ink">Email*</label>
                        <input type="email" id="contact_email" name="contact_email" required class="bg-crema rounded-lg px-6 py-4 font-geist text-sm leading-5 text-ink border-none outline-none focus:ring-2 focus:ring-ocean transition placeholder:text-ink/50" />
                    </div>
                </div>

                <!-- Phone Number, Related Store Location (if any) -->
                <div class="flex gap-6 w-full">
                    <div class="flex-1 flex flex-col gap-3.5">
                        <label for="contact_phone" class="font-geist font-normal text-sm leading-5 text-ink">Phone Number</label>
                        <input
                            type="tel"
                            id="contact_phone"
                            name="contact_phone"
                            inputmode="numeric"
                            autocomplete="tel"
                            pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
                            title="Please enter a 10-digit phone number (e.g., 914-555-1234)."
                            maxlength="12"
                            class="bg-crema rounded-lg px-6 py-4 font-geist text-sm leading-5 text-ink border-none outline-none focus:ring-2 focus:ring-ocean transition placeholder:text-ink/50"
                        />
                    </div>
                    <div class="flex-1 flex flex-col gap-3.5">
                        <label class="font-geist font-normal text-sm leading-5 text-ink">Related Store Location (if any)</label>
                        <div class="relative" data-dropdown="store_location">
                            <button type="button" class="bg-crema rounded-lg px-6 py-4 w-full font-geist text-sm leading-5 text-ink border-none outline-none focus:ring-2 focus:ring-ocean transition cursor-pointer flex justify-between items-center" aria-haspopup="listbox" aria-expanded="false">
                                <span class="dropdown-label text-ink/50">Choose a location...</span>
                                <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg" class="transition-transform duration-300">
                                    <path d="M1 1.5L6 6.5L11 1.5" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </button>
                            <input type="hidden" name="contact_store_location" id="contact_store_location" />
                            <div class="dropdown-menu absolute left-0 right-0 top-full mt-1 bg-crema rounded-lg shadow-lg z-20 hidden overflow-hidden">
                                <label class="flex items-center gap-3 px-6 py-3 hover:bg-tortilla cursor-pointer transition-colors">
                                    <input type="radio" name="store_location_ui" value="Bronxville, NY" class="w-4 h-4 accent-ocean cursor-pointer" />
                                    <span class="font-geist text-sm text-ink">Bronxville, NY</span>
                                </label>
                                <label class="flex items-center gap-3 px-6 py-3 hover:bg-tortilla cursor-pointer transition-colors">
                                    <input type="radio" name="store_location_ui" value="New Rochelle, NY" class="w-4 h-4 accent-ocean cursor-pointer" />
                                    <span class="font-geist text-sm text-ink">New Rochelle, NY</span>
                                </label>
                                <label class="flex items-center gap-3 px-6 py-3 hover:bg-tortilla cursor-pointer transition-colors">
                                    <input type="radio" name="store_location_ui" value="Pleasantville, NY" class="w-4 h-4 accent-ocean cursor-pointer" />
                                    <span class="font-geist text-sm text-ink">Pleasantville, NY</span>
                                </label>
                                <label class="flex items-center gap-3 px-6 py-3 hover:bg-tortilla cursor-pointer transition-colors">
                                    <input type="radio" name="store_location_ui" value="Stamford, CT" class="w-4 h-4 accent-ocean cursor-pointer" />
                                    <span class="font-geist text-sm text-ink">Stamford, CT</span>
                                </label>
                                <label class="flex items-center gap-3 px-6 py-3 hover:bg-tortilla cursor-pointer transition-colors">
                                    <input type="radio" name="store_location_ui" value="Tarrytown, NY" class="w-4 h-4 accent-ocean cursor-pointer" />
                                    <span class="font-geist text-sm text-ink">Tarrytown, NY</span>
                                </label>
                                <label class="flex items-center gap-3 px-6 py-3 hover:bg-tortilla cursor-pointer transition-colors">
                                    <input type="radio" name="store_location_ui" value="Yonkers, NY" class="w-4 h-4 accent-ocean cursor-pointer" />
                                    <span class="font-geist text-sm text-ink">Yonkers, NY</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

           

                <!-- Fourth Row: Message -->
                <div class="flex flex-col gap-3.5 w-full">
                    <label for="contact_message" class="font-geist font-normal text-sm leading-[1.4] text-ink">Comments</label>
                    <textarea id="contact_message" name="contact_message" required rows="6" class="bg-crema rounded-lg px-5 py-3 font-geist text-sm leading-[1.4] text-ink border-none outline-none focus:ring-2 focus:ring-ocean transition resize-none"></textarea>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-start">
                    <button type="submit" class="bg-hot-sauce text-crema rounded-lg px-5 py-2 font-geist font-normal text-sm leading-5 uppercase hover:opacity-90 transition-opacity cursor-pointer">Submit Form</button>
                </div>
            </form>


            <div id="contact-success" role="status" aria-live="polite" class="hidden flex">
                <div class="max-w-2xl bg-crema border border-hot-sauce/40 rounded-2xl px-6 py-8 flex flex-col gap-4 shadow-md">
                    <p class="font-futura text-hot-sauce text-4xl leading-tight uppercase">Got it!</p>
                    <p class="font-geist text-ink text-sm leading-5">
                        Thank you for contacting us! We've received your message and someone from our team will be in touch soon.
                    </p>
                    <div class="flex flex-wrap gap-4">
                        <a href="/" class="btn btn-primary inline-flex items-center gap-2 bg-hot-sauce text-crema font-geist text-sm uppercase px-6 py-3 hover:opacity-90 transition-opacity w-fit">
                            Back to Home
                            <svg class="w-4 h-4" aria-hidden="true" focusable="false">
                                <use href="#icon-arrow-right"></use>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>


        </div>

    </section>

    <StoreLocator />
    <InstagramFeed />
</BaseLayout>

<script>
    // Show success message if form was submitted
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success') === 'true') {
        document.getElementById('contact-form')?.classList.add('hidden');
        document.getElementById('contact-success')?.classList.remove('hidden');
    }

    // Store Location dropdown
    document.querySelectorAll('[data-dropdown="store_location"]').forEach((dropdown) => {
        const button = dropdown.querySelector('button');
        const menu = dropdown.querySelector('.dropdown-menu');
        const label = dropdown.querySelector('.dropdown-label');
        const hiddenInput = dropdown.querySelector('input[type="hidden"]');
        const radios = dropdown.querySelectorAll('input[type="radio"]');
        const chevron = button?.querySelector('svg');

        button?.addEventListener('click', () => {
            const isOpen = menu?.classList.contains('hidden') === false;
            menu?.classList.toggle('hidden');
            button.setAttribute('aria-expanded', String(!isOpen));
            chevron?.classList.toggle('rotate-180', !isOpen);
        });

        radios.forEach((radio) => {
            radio.addEventListener('change', () => {
                if (label && hiddenInput) {
                    label.textContent = radio.value;
                    label.classList.remove('text-ink/50');
                    label.classList.add('text-ink');
                    hiddenInput.value = radio.value;
                }
            });
        });

        // Close on outside click
        document.addEventListener('click', (e) => {
            if (!dropdown.contains(e.target)) {
                menu?.classList.add('hidden');
                button?.setAttribute('aria-expanded', 'false');
                chevron?.classList.remove('rotate-180');
            }
        });
    });

    // Phone number masking (###-###-####)
    const phoneInput = document.getElementById('contact_phone');
    if (phoneInput instanceof HTMLInputElement) {
        const formatPhone = (value) => {
            const digits = value.replace(/\D/g, '').slice(0, 10);
            const parts = [];
            if (digits.length > 0) parts.push(digits.slice(0, Math.min(3, digits.length)));
            if (digits.length > 3) parts.push(digits.slice(3, Math.min(6, digits.length)));
            if (digits.length > 6) parts.push(digits.slice(6, 10));
            return parts.join('-');
        };

        phoneInput.addEventListener('input', () => {
            const formatted = formatPhone(phoneInput.value);
            phoneInput.value = formatted;
        });
    }

    // Email normalization
    const emailInput = document.getElementById('contact_email');
    if (emailInput instanceof HTMLInputElement) {
        const normalizeEmail = () => {
            emailInput.value = emailInput.value.trim().toLowerCase();
        };

        emailInput.addEventListener('blur', normalizeEmail);
        emailInput.addEventListener('change', normalizeEmail);
    }
</script>
