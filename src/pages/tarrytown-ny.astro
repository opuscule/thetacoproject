---
import CateringCTA from "../components/CateringCTA.astro";
import InstagramFeed from "../components/InstagramFeed.astro";
import StoreSlider from "../components/StoreSlider.astro";
import TestimonialSlider from "../components/TestimonialSlider.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Fetch reviews for schema markup (separate from slider which handles its own fetch)
let schemaTestimonials: { quote: string; author: string }[] = [];

try {
    const reviews = await getCollection("reviews", ({ data }) => {
        return data.location === "Tarrytown" && data.type === "Restaurant" && data.display === true;
    });

    if (reviews && reviews.length > 0) {
        schemaTestimonials = reviews.slice(0, 4).map((review) => ({
            quote: review.data.quote,
            author: review.data.name,
        }));
    }
} catch (e) {
    console.error("Unexpected error fetching reviews for schema:", e);
}

// Aggregate rating data for schema
const aggregateRating = {
    ratingValue: "4.8",
    reviewCount: "285",
    bestRating: "5"
};
---

<BaseLayout title="Best Tacos in Tarrytown | Mexican Restaurant | Lunch & Dinner" description="Join us on Main Street for the best tacos in Tarrytown, NY. Open for lunch and dinner every day! Stop by or order online.">
    <!-- Review Schema -->
    <script type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Restaurant",
        "name": "The Taco Project - Tarrytown",
        "image": "https://thetacoproject.com/tarrytown_banner.jpg",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "18 Main St",
            "addressLocality": "Tarrytown",
            "addressRegion": "NY",
            "postalCode": "10591",
            "addressCountry": "US"
        },
        "telephone": "+1-914-909-4455",
        "servesCuisine": "Mexican",
        "priceRange": "$$",
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": aggregateRating.ratingValue,
            "bestRating": aggregateRating.bestRating,
            "reviewCount": aggregateRating.reviewCount
        },
        "review": schemaTestimonials.map((t) => ({
            "@type": "Review",
            "reviewRating": {
                "@type": "Rating",
                "ratingValue": "5",
                "bestRating": "5"
            },
            "author": {
                "@type": "Person",
                "name": t.author
            },
            "reviewBody": t.quote
        }))
    })} />

    <!-- Banner Section -->
    <section class="bg-crema relative flex flex-col md:flex-row min-h-[55vh]">
        <div class="w-full md:w-[50vw] order-2 md:order-1 min-h-90 bg-[url('/tarrytown_banner.jpg')] bg-cover bg-center"></div>

        <!-- Right Column: Text Content -->
        <div class="flex flex-col order-1 md:order-2">
            <div class="py-9 px-6 md:px-12 w-full md:max-w-[calc(var(--max-content-width)*0.5)] h-full flex flex-col justify-between gap-12 md:gap-24">
                <h1 class="font-futura text-ink text-14 md:text-8xl leading-[0.88] uppercase tracking-tight">
                    Tarrytown,<br />New York
                </h1>
                <div class="flex flex-col gap-9">
                    <div class="flex flex-col gap-3.5">
                        <p class="font-geist text-ink text-sm text-3.5 leading-[1.4]">18 Main St. Tarrytown, NY 10591</p>
                        <p class="font-geist text-ink text-sm leading-[1.4]">
                            11am-9pm Sunday-Thursday<br />
                            11am-10pm Friday &amp; Saturday
                        </p>
                        <div class="flex items-center gap-2">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g class="oi-phone">
                                    <path class="oi-box" d="M16 2.5H8C6.89543 2.5 6 3.39543 6 4.5V19.5C6 20.6046 6.89543 21.5 8 21.5H16C17.1046 21.5 18 20.6046 18 19.5V4.5C18 3.39543 17.1046 2.5 16 2.5Z" stroke="var(--color-hot-sauce)" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path class="oi-mini-dot" d="M12 18H12.012" stroke="var(--color-hot-sauce)" stroke-width="2.00" stroke-linecap="round"></path>
                                </g>
                            </svg>
                            <a href="tel:+19149094455" class="font-geist text-hot-sauce text-sm leading-[1.4]">(914) 909-4455</a>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g class="oi-email">
                                    <path class="oi-box" d="M3 6C3 5.44772 3.44772 5 4 5H20C20.5523 5 21 5.44772 21 6V18C21 18.5523 20.5523 19 20 19H4C3.44772 19 3 18.5523 3 18V6Z" stroke="var(--color-hot-sauce)" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path class="oi-vector" d="M4 6L12 13L20 6" stroke="var(--color-hot-sauce)" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
                                </g>
                            </svg>
                            <a href="mailto:tarrytown@thetacoproject.com" class="font-geist text-hot-sauce text-sm leading-[1.4]">tarrytown@thetacoproject.com</a>
                        </div>
                    </div>
                    <div class="flex flex-row flex-wrap items-center gap-8">
                        <a href="https://order.toasttab.com/online/the-taco-project-tarrytown-18-main-street" rel="noopener nofollow noreferrer" target="_blank" class="btn btn-primary inline-flex items-center gap-2 bg-hot-sauce text-crema font-geist text-sm uppercase px-6 py-3 hover:opacity-90 transition-opacity w-fit">
                            Order online
                            <svg class="w-4 h-4" aria-hidden="true" focusable="false">
                                <use href="#icon-external-link"></use>
                            </svg>
                        </a>
                        <a href="https://www.toasttab.com/catering/the-taco-project-tarrytown-18-main-street" rel="noopener nofollow noreferrer" target="_blank" class="font-geist text-hot-sauce">
                            <div class="flex items-center gap-2 text-hot-sauce font-geist text-sm uppercase transition-all duration-500 hover:text-ink group-focus:text-ink">
                                Order Catering
                                <svg class="w-4 h-4" aria-hidden="true" focusable="false">
                                    <use href="#icon-external-link"></use>
                                </svg>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- location details -->
    <section id="store_details" class="bg-tortilla pt-10 md:pt-16">
        <div class="px-6">
            <div class="flex flex-col gap-9 max-w-lg">
                <p class="font-geist text-ink text-sm leading-[1.4]">At The Taco Project in Tarrytown, we're committed to providing our customers with an authentic and memorable dining experience. That's why we pride ourselves on our friendly service, cozy atmosphere, and vibrant flavors. From our colorful decor to our festive music, we're dedicated to bringing the energy and excitement of Mexico to every meal.</p>
            </div>
        </div>

        <div class="px-6 md:px-8 lg:px-12 overflow-x-auto py-12">
            <!-- Photo Layout -->
            <div class="flex gap-4 w-max items-end">
                <img src="/tarrytown-taco-project-2.jpg" alt="Tarrytown Taco Project Interior" class="w-[57vw] md:w-[40vw] lg:w-[28vw]" loading="lazy" decoding="async" />
                <img src="/tarrytown-2.webp" alt="Menu Items from The Taco Project" class="w-[57vw] md:w-[40vw] lg:w-[28vw]" loading="lazy" decoding="async" />
                <img src="/tarrytown-1.webp" alt="Delicious Food at The Taco Project" class="w-[57vw] md:w-[40vw] lg:w-[28vw]" loading="lazy" decoding="async" />
                <img src="/tarrytown-4.webp" alt="Friends Eating at The Taco Project" class="w-[57vw] md:w-[40vw] lg:w-[28vw]" loading="lazy" decoding="async" />
                <img src="/tarrytown-taco-project-4.jpg" alt="Food at The Taco Project" class="w-[57vw] md:w-[40vw] lg:w-[28vw]" loading="lazy" decoding="async" />
            </div>
        </div>
    </section>

    <CateringCTA />

    <TestimonialSlider location="Tarrytown" type="Restaurant" />

    <StoreSlider />

    <InstagramFeed />

</BaseLayout>
